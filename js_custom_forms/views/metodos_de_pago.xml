<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- El cliente final(person) sólo tiene la opción Tarjeta para pagar en la web. El cliente Empresa(company) tiene todos los métodos de pago -->
    <template id="js_lista_metodos_de_pago" inherit_id="payment.payment_tokens_list" name="JS Lista Metodos de pago" priority="20">
        <xpath expr="//t[@t-foreach='form_acquirers']" position="replace">
            <t t-set="tipo_empresa_padre" t-value="request.env.user.partner_id.parent_id.company_type" />
            <t t-set="id_termino_pago" t-value="request.env.user.partner_id.property_payment_term_id.id" />

            <t t-if="mode == 'payment'" t-foreach="form_acquirers" t-as="acq">
                <t t-if="request.env.user.partner_id.company_type == 'person' and not tipo_empresa_padre and acq.id != 8">
                    <!-- 
                        Esto es como un break del foreach. 
                        Si el cliente es person (y no company) y el ID del Método de Pago es distinto de Stripe (8)
                        [Transferencia (5), Cheque(9) o Mis condiciones de pago (11)]
                        no se muestran esos métodos de pago = en clientes finales sólo se muestra tarjeta.
                    -->
                    <!--
                    	Añadido request.env.user.partner_id.parent_id.company_type para contemplar el caso en que que el usuario sea person, pero que no tenga parent.
						Si es person y tiene parent, es una dirección de facturacion o de envío, o persona de contacto, dentro de una empresa padre. El término de pago lo hereda de su padre.
                     -->
                </t>
                <t t-elif="(not id_termino_pago or id_termino_pago == 1) and acq.id == 11">
                    <!--
                        Esto es como un break del foreach.
                        Cuando un contacto individual tiene parent, su termino de pago es el de su parent.
                        Si el cliente no tiene términos de pago o el ID del termino de pago es 1 (pago inmediato)
                        y el ID método de pago que toca en este loop del foreach es 11 (Mis condiciones de pago)
                        no se muestra ese método de pago = el método de pago "Mis condiciones" se muestra si el término de pago de
                        este usuario existe y no es "Pago inmediato" (ID=1).
                    -->
                </t>
                <t t-else="">
                    <div class="panel-body">
                        <label>
                            <input type="radio" t-att-data-acquirer-id="acq.id" t-att-data-form-payment="true" t-att-data-provider="acq.provider" t-att-class="'hidden' if (acquirers_count==1 and pms_count==0) else ''" t-att-checked="acquirers_count==1 and pms_count==0" name="pm_id" t-attf-value="form_{{acq.id}}" />                            
                            <span class="payment_icon_name" t-esc="acq.name" />
                        </label>
                        <ul class="pull-right list-inline payment_icon_list">
                            <t t-set="i" t-value="0" />
                            <t t-foreach="acq.payment_icon_ids" t-as="pm_icon">
                                <li t-att-class=" '' if (i &lt; MAX_BRAND_LINE) else 'hidden'">
                                    <span t-field="pm_icon.image_payment_form" t-options="{&quot;widget&quot;: &quot;image&quot;, &quot;alt-field&quot;: &quot;name&quot;}" />
                                </li>
                                <li t-if="i==MAX_BRAND_LINE" style="display:block;">
                                    <span class="pull-right more_option text-info">
                                        <a href="#" class="o_payment_form_pay_icon_more" data-toggle="tooltip" t-att-title="', '.join([opt.name for opt in acq.payment_icon_ids[MAX_BRAND_LINE:]])">and more</a>
                                    </span>
                                </li>
                                <t t-set="i" t-value="i+1" />
                            </t>
                        </ul>
                    </div>
                    <div t-attf-id="o_payment_form_acq_{{acq.id}}" t-attf-class="hidden {{'panel-footer' if acq.save_token == 'ask' else ''}}">
                        <label t-if="acq.save_token == 'ask'"><input type="checkbox" name="o_payment_form_save_token" data-remove-me="" /> Save my payment data</label>
                    </div>
                </t>
            </t>
        </xpath>
    </template>
</odoo>