<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="custom_products" inherit_id="website_sale.products" name="Custom Products">

        <!-- Banner de cabecera y texto -->
        <xpath expr="//section[hasclass('s_image_text')]" position="attributes">
            <attribute name="id">shop_banner</attribute>
        </xpath>

        <xpath expr="//section[hasclass('s_image_text')]/div" position="inside">
            <h1>Where sports begin...</h1>
        </xpath>

        <!-- Clase para tienda (listado) -->
        <xpath expr="//div[@id='wrap']" position="attributes">
            <attribute name="class">js_sale shop_main</attribute>
        </xpath>

        <!-- Colocar buscador encima de categoría de productos -->
        <xpath expr="//div[@id='products_grid_before']" position="replace">
            <div class="hidden" id="products_grid_before">
                <t t-call="website_sale.search">
                    <t t-set="search_class" t-value="'o_website_sale_search'"/>
                </t>

                <div id="cat_collapse" class="btn btn-primary btn-default visible-xs">CATEGORÍAS <span class="glyphicon glyphicon-chevron-down"></span></div>

                <ul class="nav nav-pills nav-stacked">
                    <li t-att-class=" '' if category else 'active' ">
                        <a href="/shop" class="o_not_editable">Todos los productos</a>
                    </li>
                    <!-- Quitar historia de búsqueda -->
                    <t t-foreach="categories" t-as="c">
                        <li t-att-class="'active' if c.id == int(category or 0) else None">
                            <a t-att-href="'/shop/category/' + slug(c)" t-field="c.name"/>
                            <ul t-if="c.child_id" class="nav nav-pills nav-stacked nav-hierarchy">
                                <t t-foreach="c.child_id" t-as="c">
                                    <t t-call="website_sale.categories_recursive"/>
                                </t>
                            </ul>
                        </li>
                    </t>
                </ul>
            </div>
        </xpath>

        <xpath expr="//div[@id='products_grid_before']" position="attributes">
            <attribute name="class">col-md-3 col-sm-4 col-xs-12</attribute>
        </xpath>

        <xpath expr="//div[@id='products_grid']" position="attributes">
            <attribute name="class">col-md-9 col-sm-8</attribute>
        </xpath>

        <!-- Quitar paginacion superior y dejar solo pricelist y selector de ordenar -->
        <xpath expr="//div[@id='products_grid']" position="before">
            <div id="products_tools">
                <span id="category_name"><t t-esc="category.name if category else 'Tienda'"/></span>

                <t t-call="website_sale.pricelist_list"/>

                <t t-set="name_asc_label">Nombre: de la A a la Z</t>
                <t t-set="name_desc_label">Nombre: de la Z a la A</t>
                <t t-set="website_sale_sortable" t-value="[(name_asc_label, 'name asc'), (name_desc_label, 'name desc')]"/>
                <t t-set="website_sale_sortable_current" t-value="[sort for sort in website_sale_sortable if sort[1]==request.params.get('order', '')]"/>
                <div class="dropdown btn-group dropdown_sorty_by">
                    <a href="#" class="dropdown-toggle btn btn-default" data-toggle="dropdown">
                        <t t-if="len(website_sale_sortable_current)">
                            <span>Ordenado por: <t t-raw="website_sale_sortable_current[0][0]"/></span>
                        </t>
                        <t t-else="1">
                            <span>Ordenar por</span>
                            <span class="caret"/>
                        </t>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                        <li t-foreach="website_sale_sortable" t-as="sortby">
                            <a t-att-href="keep('/shop', order=sortby[1])">
                                <span t-raw="sortby[0]"/>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </xpath>

        <!-- Quitar el buscador de su sitio original -->
        <xpath expr="//div[hasclass('products_pager')]" position="replace"></xpath>

        <!-- Quitar paginación inferior -->
        <xpath expr="//div[hasclass('products_pager')]" position="replace"></xpath>

        <!-- Quitar espacio antes del footer -->
        <xpath expr="//div[hasclass('oe_structure', 'mb32')]" position="replace"></xpath>

        <!-- Poner paginación dentro del div de productos -->
        <xpath expr="//div[@id='products_grid']" position="inside">
            <div class="products_pager inside">
                <ul t-if="pager['page_count'] &gt; 1" t-attf-class="#{ classname or '' } pagination" t-att-style="style or None">
                    <li t-att-class=" 'disabled' if pager['page']['num'] == 1 else None ">
                        <a t-att-href=" pager['page_previous']['url'] if pager['page']['num'] != 1 else None"><span class="glyphicon glyphicon-chevron-left"></span></a>
                    </li>
                    <t t-foreach="pager['pages']" t-as="page">
                        <li t-att-class=" 'active' if page['num'] == pager['page']['num'] else None "> <a t-att-href="page['url']" t-raw="page['num']"/></li>
                    </t>
                    <li t-att-class=" 'disabled' if pager['page']['num'] == pager['page_count'] else None ">
                        <a t-att-href="pager['page_next']['url'] if pager['page']['num'] != pager['page_count'] else None"><span class="glyphicon glyphicon-chevron-right"></span></a>
                    </li>
                </ul>
            </div>
        </xpath>

    </template>

    <template id="custom_product" inherit_id="website_sale.product" name="Custom Product">

      <!-- Hacer el breadcrumb más ancho  -->
      <xpath expr="//div[hasclass('col-sm-4')]" position="replace">
          <div class="col-sm-9">
              <ol class="breadcrumb">
                  <li>
                      <a t-att-href="keep(category=0)">Productos</a>
                  </li>
                  <li t-if="category">
                      <a t-att-href="keep('/shop/category/%s' % slug(category), category=0)" t-field="category.name"/>
                  </li>
                  <li class="active">
                      <span t-field="product.name"/>
                  </li>
              </ol>
          </div>
      </xpath>

    </template>

    <template id="custom_products_item" inherit_id="website_sale.products_item" name="Custom Products Item">

        <!-- Modificacion en product_item (sacar precios y botones del section)  -->
        <xpath expr="//form" position="replace">
            <form action="/shop/cart/update" method="post">
                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                <div itemscope="itemscope" itemtype="http://schema.org/Product">
                    <div class="ribbon-wrapper">
                        <div class="ribbon btn btn-danger">Oferta</div>
                    </div>
                    <div class="oe_product_image">
                        <a itemprop="url" t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))">
                            <span itemprop="image" t-attf-content="{{request.httprequest.url_root}}web/image/product.template/{{product.id}}/image" t-field="product.image" t-options="{'widget': 'image', 'resize': None if product_image_big else '300x300', 'zoom': 'image'}" t-att-alt="product.name"/>
                        </a>
                    </div>
                    <t t-if="show_publish">
                        <div id="website_published_button" class="" groups="sales_team.group_sale_manager">
                            <t t-call="website.publish_management">
                                <t t-set="object" t-value="product"/>
                                <t t-set="publish_edit" t-value="True"/>
                                <t t-set="action" t-value="'product.product_template_action'"/>
                            </t>
                        </div>
                    </t>
                    <section>
                        <h5>
                            <strong>
                                <a itemprop="name" t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))" t-att-content="product.name" t-field="product.name"/>
                            </strong>
                        </h5>
                    </section>
                    <div itemprop="offers" itemscope="itemscope" itemtype="http://schema.org/Offer" class="product_price" t-if="product.product_variant_ids">
                        <b>
                            <t t-if="product.website_price_difference and website.get_current_pricelist().discount_policy=='without_discount'">
                                <del class="text-danger mr8" style="white-space: nowrap;" t-esc="compute_currency(product.website_public_price)" t-options="{'widget': 'monetary', 'display_currency': website.get_current_pricelist().currency_id, 'from_currency': website.currency_id}"/>
                            </t>

                            <t t-if="product.website_price_max > 0">
                                <!--<span t-esc="product.website_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>-->
                                <span t-esc="'{:.2f}'.format(product.website_price_min) + ' - '" t-if="product.website_price_min != product.website_price_max" />
                                <span t-esc="product.website_price_max" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}"/>
                            </t>

                            <span t-else="">Consultar Precio</span>

                            <span itemprop="price" style="display:none;" t-esc="product.website_price"/>
                            <span itemprop="priceCurrency" style="display:none;" t-esc="website.currency_id.name"/>

                            <!-- AÑADIR PRODUCTO AL CARRITO -->
                            <input name="product_id" t-att-value="product.product_variant_id.id" type="hidden"/>

                            <!-- Si el producto no tiene precio no mostrar opciones de compra (en grid) -->
                            <t t-if="product.website_price_max > 0">
                                <t t-if="len(product.product_variant_ids) == 1">
                                    <a class="btn btn-default btn-xs a-submit">
                                        <span class="fa fa-shopping-cart"/>
                                    </a>
                                </t>
                                <t t-if="len(product.product_variant_ids) &gt; 1">
                                    <a class="btn btn-default btn-xs" t-att-href="keep('/shop/product/%s' % slug(product), page=(pager['page']['num'] if pager['page']['num']&gt;1 else None))">
                                        <span class="fa fa-shopping-cart"/>
                                    </a>
                                </t>
                            </t>
                        </b>
                        <input name="product_id" t-att-value="product.product_variant_id.id" type="hidden"/>
                    </div>
                </div>
            </form>
        </xpath>

    </template>

</odoo>
